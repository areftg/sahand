"use strict";(self.webpackChunksjm=self.webpackChunksjm||[]).push([[527],{9527:(e,t,a)=>{a.r(t),a.d(t,{default:()=>A});var n=a(3986),l=a(9379),r=a(5043);const s={settingsPanel:"AlertPanel_settingsPanel__pXZzJ",profilePanelIcon:"AlertPanel_profilePanelIcon__FQmnr",toptitle:"AlertPanel_toptitle__nctep",disabled:"AlertPanel_disabled__XoHSg",tabs:"AlertPanel_tabs__bgCXy",navButton:"AlertPanel_navButton__4QajJ",deleteTabIcon:"AlertPanel_deleteTabIcon__9UDZr",alerterror:"AlertPanel_alerterror__eYh57",alarmError:"AlertPanel_alarmError__RCMPw",button:"AlertPanel_button__KSVyU",m:"AlertPanel_m__B78nA",green:"AlertPanel_green__DnrVX",first:"AlertPanel_first__-fNgy",alarms:"AlertPanel_alarms__G1eK-",delete:"AlertPanel_delete__O1yd7",datetimeslot:"AlertPanel_datetimeslot__nIsVy",datetimeslotbutton:"AlertPanel_datetimeslotbutton__MavUq",name:"AlertPanel_name__nqftX",alarmoff:"AlertPanel_alarmoff__rmXKO",alarmcont:"AlertPanel_alarmcont__3m2Dx",togglebutton:"AlertPanel_togglebutton__t+m4p",circle:"AlertPanel_circle__U8TrM",on:"AlertPanel_on__8cRWb",onText:"AlertPanel_onText__mWWDA",offText:"AlertPanel_offText__XgnhD",radioOption:"AlertPanel_radioOption__thw4M",radioOuterCircle:"AlertPanel_radioOuterCircle__rGCqI",radioInnerCircle:"AlertPanel_radioInnerCircle__U9ic7",radioLabel:"AlertPanel_radioLabel__S0jei",selected:"AlertPanel_selected__ojzSK",butcont:"AlertPanel_butcont__6zFLR"};var i=a(541),c=a(8335),o=a(9413),d=a(4852),m=a(9530),u=a(3372),_=(a(2420),a(579));const p={display:"flex",flexDirection:"row-reverse",alignItems:"center",fontFamily:"bold",fontSize:"16px",direction:"rtl",backgroundColor:"#f0f0f0",borderRadius:"9px",padding:"6px",gap:"6px",width:"fit-content",height:"35px",margin:"10px 0"},g={width:"30px",textAlign:"center",fontFamily:"bold",fontSize:"15px",fontWeight:"bold",padding:"3px",border:"0",outline:"none",borderRadius:"4px",backgroundColor:"transparent",height:"25px"},h={fontSize:"20px",margin:"0 4px",fontFamily:"bold"},x=function(e){let{defaultValue:t="00:00",onTimeChange:a}=e;const[n,l]=(0,r.useState)("00"),[s,i]=(0,r.useState)("00"),c=(0,r.useRef)(null),o=(0,r.useRef)(t),d=(0,r.useCallback)(e=>{const t=parseInt(e,10);return isNaN(t)?"00":t.toString().padStart(2,"0")},[]),m=(0,r.useCallback)(e=>String(parseInt(e,10)||0),[]);(0,r.useEffect)(()=>{const[e="00",a="00"]=t.split(":"),n=d(e),r=d(a);l(n),i(r),o.current="".concat(n,":").concat(r)},[t,d]),(0,r.useEffect)(()=>(clearTimeout(c.current),c.current=setTimeout(()=>{const e="".concat(d(n),":").concat(d(s));a&&e!==o.current&&(a(e),o.current=e)},500),()=>{clearTimeout(c.current)}),[n,s,a,d]);const u=(0,r.useCallback)((e,t)=>{const a=e.replace(/[^\d]/g,"").slice(0,2);let n=parseInt(a,10);isNaN(n)&&(n=0),"hour"===t?(n>23&&(n=23),l(String(n))):(n>59&&(n=59),i(String(n)))},[]),x=(0,r.useCallback)(e=>{e.target.select();"hour"===e.target.name?l(m):i(m)},[m]),f=(0,r.useCallback)(e=>{"hour"===e.target.name?l(d):i(d)},[d]);return(0,_.jsxs)("div",{style:p,children:[(0,_.jsx)("input",{type:"text",inputMode:"numeric",dir:"rtl",name:"hour",value:n,onChange:e=>u(e.target.value,"hour"),onFocus:x,onBlur:f,style:g,placeholder:"\u0633\u0627\u0639\u062a"}),(0,_.jsx)("span",{style:h,children:":"}),(0,_.jsx)("input",{type:"text",inputMode:"numeric",dir:"rtl",name:"minute",value:s,onChange:e=>u(e.target.value,"minute"),onFocus:x,onBlur:f,style:g,placeholder:"\u062f\u0642\u06cc\u0642\u0647"})]})},f=["id","isNew"],A=e=>{let{onClose:t}=e;const{timeSlots:a,loading:p,error:g,refetch:h}=(0,i.Z)(),[A,b]=(0,r.useState)([]),[j,v]=(0,r.useState)(!1),[P,N]=(0,r.useState)({message:null,sourceId:null}),[y,C]=(0,r.useState)(!1);(0,r.useEffect)(()=>{console.log("AlertPanel received from context:",{initialAlerts:a,loading:p,contextError:g}),a&&Array.isArray(a)&&b(JSON.parse(JSON.stringify(a)))},[a,p,g]);const S=(e,t,a)=>{b(n=>n.map(n=>n.id===t?(0,l.A)((0,l.A)({},n),{},{[a]:e}):n)),N({message:null,sourceId:null})},w=e=>({1:"\u0627\u0648\u0644",2:"\u062f\u0648\u0645",3:"\u0633\u0648\u0645",4:"\u0686\u0647\u0627\u0631\u0645",5:"\u067e\u0646\u062c\u0645",6:"\u0634\u0634\u0645",7:"\u0647\u0641\u062a\u0645",8:"\u0647\u0634\u062a\u0645",9:"\u0646\u0647\u0645",10:"\u062f\u0647\u0645"}[e]||e.toString());if(p)return(0,_.jsxs)("div",{className:s.settingsPanel,children:[(0,_.jsx)("img",{className:s.profilePanelIcon,src:o.A,alt:"\u0628\u0633\u062a\u0646",onClick:t}),(0,_.jsx)("img",{className:s.toptitle,src:d.A,alt:"\u0622\u06cc\u06a9\u0648\u0646 \u0632\u0646\u06af"}),(0,_.jsx)("h3",{children:"\u0633\u06cc\u0633\u062a\u0645 \u0632\u0646\u06af \u0647\u0648\u0634\u0645\u0646\u062f"}),(0,_.jsx)("div",{className:"".concat(s.button," ").concat(s.green),children:"\u0632\u0646\u06af \u0632\u062f\u0646 \u0628\u0647 \u0635\u0648\u0631\u062a \u062f\u0633\u062a\u06cc"}),(0,_.jsxs)("div",{className:"".concat(s.button),children:[(0,_.jsx)(u.A,{style:{margin:"10px 10px",borderRadius:"25px"},duration:2,height:34,width:80})," \u0632\u0646\u06af \u0627\u062a\u0648\u0645\u0627\u062a\u06cc\u06a9"]}),(0,_.jsx)(u.A,{duration:2,highlightColor:"#69b0b2",count:5,style:{margin:"10px 0"},height:50})]});const I=JSON.stringify(A)!==JSON.stringify(a);return(0,_.jsxs)("div",{className:s.settingsPanel,children:[(0,_.jsx)("img",{className:s.profilePanelIcon,src:o.A,alt:"\u0628\u0633\u062a\u0646",onClick:t}),(0,_.jsx)("img",{className:s.toptitle,src:d.A,alt:"\u0622\u06cc\u06a9\u0648\u0646 \u0632\u0646\u06af"}),(0,_.jsx)("h3",{children:"\u0633\u06cc\u0633\u062a\u0645 \u0632\u0646\u06af \u0647\u0648\u0634\u0645\u0646\u062f"}),P.message&&(0,_.jsx)("p",{className:s.alerterror,children:P.message}),g.message&&(0,_.jsx)("p",{className:s.alerterror,children:g.message}),(0,_.jsx)("div",{className:"".concat(s.button," ").concat(s.green," ").concat(s.first),children:"\u0632\u0646\u06af \u0632\u062f\u0646 \u0628\u0647 \u0635\u0648\u0631\u062a \u062f\u0633\u062a\u06cc"}),(0,_.jsxs)("div",{className:"".concat(s.button),onClick:()=>{C(e=>!e)},children:[(0,_.jsxs)("div",{className:"".concat(s.togglebutton," ").concat(y?s.on:""),children:[(0,_.jsx)("span",{className:s.onText,children:"\u0631\u0648\u0634\u0646"}),(0,_.jsx)("span",{className:s.offText,children:"\u062e\u0627\u0645\u0648\u0634"}),(0,_.jsx)("div",{className:s.circle})]})," \u0632\u0646\u06af \u0627\u062a\u0648\u0645\u0627\u062a\u06cc\u06a9"]}),A&&A.length>0?A.map(e=>(0,_.jsxs)("div",{className:"".concat(s.alarms," ").concat(e.isActive?"":s.alarmoff," ").concat(e.isNew?s.newAlarm:""),children:[(0,_.jsx)("div",{className:s.delete,onClick:()=>{return t=e.id,void b(e=>e.filter(e=>e.id!==t).map((e,t)=>(0,l.A)((0,l.A)({},e),{},{name:"\u0632\u0646\u06af ".concat(w(t+1))})));var t},children:(0,_.jsx)("img",{src:m.A,alt:"\u062d\u0630\u0641"})}),(0,_.jsx)("p",{className:s.name,children:e.name}),(0,_.jsxs)("div",{className:s.alarmcont,children:[(0,_.jsx)("p",{children:"\u0627\u0632"}),(0,_.jsx)(x,{defaultValue:e.start_time,onTimeChange:t=>S(t,e.id,"start_time")}),(0,_.jsx)("p",{children:"\u062a\u0627"}),(0,_.jsx)(x,{defaultValue:e.end_time,onTimeChange:t=>S(t,e.id,"end_time")})]})]},e.id)):(0,_.jsx)("p",{className:s.noAlertsMessage,children:"\u062f\u0631 \u062d\u0627\u0644 \u062d\u0627\u0636\u0631 \u0647\u06cc\u0686 \u0632\u0646\u06af\u06cc \u062a\u0639\u0631\u06cc\u0641 \u0646\u0634\u062f\u0647 \u0627\u0633\u062a."}),(0,_.jsxs)("div",{className:s.butcont,children:[(0,_.jsxs)("div",{className:"".concat(s.button,"  ").concat(s.green),onClick:()=>{const e=A.length+1,t="\u0632\u0646\u06af ".concat(w(e)),a={id:"new-".concat(Date.now()),name:t,start_time:"00:00",end_time:"00:00",type:"class_period",isActive:!0,isNew:!0};b(e=>[...e,a])},children:[(0,_.jsx)("p",{children:"\u0627\u0641\u0632\u0648\u062f\u0646 \u0632\u0646\u06af \u062c\u062f\u06cc\u062f"}),(0,_.jsx)("div",{children:(0,_.jsx)("p",{children:"+"})})]}),(0,_.jsx)("button",{className:"".concat(s.button," ").concat(s.green),onClick:async()=>{v(!0),N({message:null,sourceId:null});const e=[],t=[],l=[],r=new Set(A.map(e=>e.id));a.forEach(e=>{r.has(e.id)||l.push(c.Ay.delete("".concat(c.vZ.adddtimeslot(),"/").concat(e.id)))}),A.forEach(l=>{if(l.isNew){const{id:t,isNew:a}=l,r=(0,n.A)(l,f);e.push(c.Ay.post(c.vZ.timeslot(),r))}else{const e=a.find(e=>e.id===l.id);if(e&&(e.start_time!==l.start_time||e.end_time!==l.end_time)){var r;const e={name:l.name,start_time:l.start_time,end_time:l.end_time,type:l.type,isActive:l.isActive,academic_level_id:null===(r=l.academic_level)||void 0===r?void 0:r.id};t.push(c.Ay.put("".concat(c.vZ.adddtimeslot(),"/").concat(l.id),e))}}});try{await Promise.all([...e,...t,...l]),await h()}catch(o){var s,i;const e=null!==(s=o.response)&&void 0!==s&&null!==(i=s.data)&&void 0!==i&&i.errors?Object.values(o.response.data.errors).flat().join(" "):"\u062e\u0637\u0627 \u062f\u0631 \u062b\u0628\u062a \u062a\u063a\u06cc\u06cc\u0631\u0627\u062a. \u0644\u0637\u0641\u0627\u064b \u0648\u0631\u0648\u062f\u06cc\u200c\u0647\u0627 \u0631\u0627 \u0628\u0631\u0631\u0633\u06cc \u06a9\u0646\u06cc\u062f.";N({message:e,sourceId:null})}finally{v(!1)}},disabled:!I||j,children:j?"\u062f\u0631 \u062d\u0627\u0644 \u062b\u0628\u062a...":"\u062b\u0628\u062a \u062a\u063a\u06cc\u06cc\u0631\u0627\u062a"})]})]})}}}]);
//# sourceMappingURL=527.58c76c30.chunk.js.map